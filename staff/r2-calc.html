<!DOCTYPE html><html ng-app="app"><head><meta charset="utf-8" /><title>R2 Calculator</title><meta content="width=device-width" name="viewport" /><link href="../assets/stylesheets/styles.css" rel="stylesheet" /><link href="../assets/stylesheets/r2_calculator.css" rel="stylesheet" /><link href="../assets/stylesheets/r1calc.css" rel="stylesheet" /><script src="../assets/javascripts/jquery.min.js"></script></head><body><div class="contain-to-grid"><nav class="top-bar" data-topbar=""><ul class="title-area"><li class="name"><h1><a href="../">Help with fees</a></h1></li></ul><ul><li class="section"><h1></h1></li></ul><section class="top-bar-section"><ul class="right"><li><a href=""></a></li></ul></section></nav></div><div class="row"><div class="large-7 columns"><div class="row"><div class="small-12 medium-12 large-12 columns"><h4>Income check</h4></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.3.14/angular.js"></script><script>function getUrlParameter(sParam) {
  var sPageURL = window.location.search.substring(1);
  var sURLVariables = sPageURL.split('&');
  for (var i = 0; i < sURLVariables.length; i++) {
    var sParameterName = sURLVariables[i].split('=');
    if (sParameterName[0] == sParam) {
      return sParameterName[1];
    }
  }
}
$(document).ready( function() {
  var fee = getUrlParameter('fee');
  console.log(fee);
  $('#r2_fee').val(fee);
});

var app = angular.module('app', []);

app.controller('Prototype', function ($scope) {
  // $scope.children = 0

  $scope.fee = 0; //parseInt($location.search().fee,10);
  $scope.resultShown = false;

  $scope.thresholds = function () {
    var couple = ($scope.couple=='true');

    var lowThreshold = 1085 + (245 * $scope.children)
    if (couple) {
      lowThreshold = lowThreshold + 160;
    }

    var highThreshold = lowThreshold + Math.min(4000, $scope.fee * 2)

    var thresholds = {
      low: lowThreshold,
      high: highThreshold
    }

    return thresholds;
  }

  $scope.incr = function (number) {
    $scope.children = $scope.children + number;
    if ($scope.children < 0) {
      $scope.children = 0;
    }
  }

  $scope.fullRemission = function () {
    return ($scope.monthlyIncome < $scope.thresholds().low);
  }

  $scope.partialRemission = function () {
    return ($scope.monthlyIncome >= $scope.thresholds().low && $scope.monthlyIncome < $scope.thresholds().high);
  }

  $scope.coupleName = function () {
    if ($scope.couple=='true') {
      return "person who is part of a couple";
    } else if ($scope.couple=='false') {
      return "single person";
    } else {
      return '';
    }
  }

  $scope.feePayable = function () {
    if (this.fullRemission()) {
      return 0;
    } else if (this.partialRemission()) {
      var incomeAboveThreshold = $scope.monthlyIncome - this.thresholds().low;
            var incomeAboveThreshold = $scope.monthlyIncome - this.thresholds().low;
            var roundedIncomeAbove = incomeAboveThreshold - (incomeAboveThreshold % 10);
            return Math.min(roundedIncomeAbove / 2, $scope.fee);      
        } else {
      return $scope.fee;
    }
  }

  $scope.feeRemitted = function () {
    return $scope.fee - this.feePayable();
  }

  $scope.showResult = function () {
    if ($scope.monthlyIncome && $scope.coupleName()!='' ) {
      $scope.resultShown = true;
    } else {
      $scope.resultShown = false;
    }
  }
});</script><div id="canvas" ng-controller="Prototype"><div class="row"><div class="small-12 medium-3 large-3 columns"><label for="r2_fee">Fee</label><div class="row collapse prefix-radius"><div class="small-2 medium-2 large-3 columns"><span class="prefix"><label class="inline" for="r2_fee">£</label></span></div><div class="small-10 medium-10 large-9 columns" style="padding:0px;"><input id="r2_fee" name="r2_fee" ng-model="fee" type="number" /></div></div></div></div><br /><div class="row"><div class="small-12 medium-6 large-5 columns"><div class="row"><div class="small-12 columns"><label for="couple-no"><input id="couple-no" name="couple" ng-model="couple" type="radio" value="false" /> Single</label><label for="couple-yes"><input id="couple-yes" name="couple" ng-model="couple" type="radio" value="true" /> Part of a couple</label></div></div></div></div><br /><div class="row"><div class="small-12 medium-6 large-5 columns" ng-init="children = 0"><label class="inline">Number of children<div class="row"><div class="columns small-3"><input min="0" ng-model="children" type="number" /></div></div></label></div></div><div class="row"><div class="small-12 medium-3 large-3 columns"><label for="r2_income">Total monthly income</label><div class="small-2 medium-2 large-3 columns" style="padding:0px;"><span class="prefix">£</span></div><div class="small-10 medium-10 large-9 columns" style="padding:0px;"><input id="r2_income" name="r2_income" ng-model="monthlyIncome" type="number" /></div></div></div><div class="row"><div class="small-12 medium-8 large-5 columns"><div class="form-group"><a class="button small no_selection" ng-click="showResult()">Check</a></div></div></div><div class="row"><div class="small-12 medium-7 large-7 columns" ng-show="resultShown"><div class="panel callout"><p>Amount remitted: {{ feeRemitted() | currency:"£" }}</p><p>Amount to pay: {{ feePayable() | currency:"£" }}</p></div></div></div></div><script>$(document).ready( function() {
  $('#r2-calc').addClass('active')
});</script></div><div class="large-5 columns"><h1></h1><br /><div class="row"><div class="columns small-12 collapse"><h2>&nbsp;</h2><div class="row sidebar collapse"><div class="columns small-12"></div></div></div></div></div></div><div class="row"><div class="small-12 columns"><br /><br /><footer class="row page-footer"><div class="small-12 columns"><div class="small-12 medium-12 large-6 columns"><h4>Contact us</h4><hr style="color:bfc1c3;" /><h5>Operational support</h5><p><a href="mailto:civil&familybusinesssupport@hmcts.gsi.gov.uk">civil&familybusinesssupport@hmcts.gsi.gov.uk </a></p><h5>Technical support</h5><p><a href="mailto:helpwithfees.support@digital.justice.gov.uk">helpwithfees.support@digital.justice.gov.uk</a></p></div><div class="small-12 medium-12 large-6 columns"><h4>Your feedback</h4><hr style="color:bfc1c3;" /><div class="small-8 columns" style="padding-left:0px;"><h5>Tell us what you think</h5><p><a href="#">Give feedback</a></p></div><div class="small-4 columns"><img src="../assets/images/copyright.png" style="padding-top:35px;" /></div></div></div></footer><p></p><a href="/"></a></div></div><script src="../assets/javascripts/libs.js"></script><script src="../assets/javascripts/app.js"></script><script src="../assets/javascripts/details.polyfill.js"></script></body></html>